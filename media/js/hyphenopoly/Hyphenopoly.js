/**
 * @license Hyphenopoly 2.7.1-devel - client side hyphenation for webbrowsers
 * ©2018  Mathias Nater, Zürich (mathiasnater at gmail dot com)
 * https://github.com/mnater/Hyphenopoly
 *
 * Released under the MIT license
 * http://mnater.github.io/Hyphenopoly/LICENSE
 */
!function(e){"use strict";function n(){return Object.create(null)}function t(e,n){return{configurable:(4&n)>0,enumerable:(2&n)>0,writable:(1&n)>0,value:e}}const r=Hyphenopoly,a=String.fromCharCode(173);Math.imul=Math.imul||function(e,n){const t=65535&e,r=65535&n;return t*r+((e>>>16&65535)*r+t*(n>>>16&65535)<<16>>>0)|0},function(){const e=Object.create(null,{defaultLanguage:t("en-us",2),dontHyphenate:t(function(){const e=n();return"abbr,acronym,audio,br,button,code,img,input,kbd,label,math,option,pre,samp,script,style,sub,sup,svg,textarea,var,video".split(",").forEach(function(n){e[n]=!0}),e}(),2),dontHyphenateClass:t("donthyphenate",2),exceptions:t(n(),2),normalize:t(!1,2),safeCopy:t(!0,2),timeout:t(1e3,2)}),o=Object.create(e),i=Object.create(null,{compound:t("hyphen",2),hyphen:t(a,2),leftmin:t(0,2),leftminPerLang:t(0,2),minWordLength:t(6,2),orphanControl:t(1,2),rightmin:t(0,2),rightminPerLang:t(0,2)});Object.keys(r.setup).forEach(function(a){if("selectors"===a){const e=Object.keys(r.setup.selectors);Object.defineProperty(o,"selectors",t(e,2)),e.forEach(function(e){const a=n();Object.keys(r.setup.selectors[e]).forEach(function(n){a[n]=t(r.setup.selectors[e][n],2)}),Object.defineProperty(o,e,t(Object.create(i,a),2))})}else if("dontHyphenate"===a){const i=n();Object.keys(r.setup.dontHyphenate).forEach(function(e){i[e]=t(r.setup.dontHyphenate[e],2)}),Object.defineProperty(o,a,t(Object.create(e.dontHyphenate,i),3))}else Object.defineProperty(o,a,t(r.setup[a],3))}),r.c=o}(),function(){function o(e,n){try{return e.getAttribute("lang")?e.getAttribute("lang").toLowerCase():"html"===e.tagName.toLowerCase()?n?y:null:o(e.parentNode,n)}catch(e){return null}}function i(){function n(e,t,c,s){s=s||!1;const l=function(e,n){return e.lang&&"string"==typeof e.lang?e.lang.toLowerCase():n&&""!==n?n.toLowerCase():o(e,!0)}(e,t);"H9Y"===r.clientFeat.langs[l]?(b.add(e,l,c),!s&&m.safeCopy&&function(e){e.addEventListener("copy",function(e){e.preventDefault();const n=window.getSelection().toString();e.clipboardData.setData("text/plain",n.replace(new RegExp(a,"g"),""))},!0)}(e)):r.clientFeat.langs[l]||r.events.dispatch("error",{lvl:"warn",msg:"Element with '"+l+"' found, but '"+l+".hpb' not loaded. Check language tags!"});const u=e.childNodes;Array.prototype.forEach.call(u,function(e){1!==e.nodeType||function(e,n){return e.matches||(e.matches=e.msMatchesSelector||e.webkitMatchesSelector),e.matches(n)}(e,i)||n(e,l,c,!0)})}b=function(){const e=new Map,n=[0];return{add:function(t,r,a){const o={element:t,selector:a};return e.has(r)||e.set(r,[]),e.get(r).push(o),n[0]+=1,o},counter:n,each:function(n){e.forEach(function(e,t){n(t,e)})},list:e}}();const t=function(){let e="."+r.c.dontHyphenateClass,n=null;for(n in m.dontHyphenate)m.dontHyphenate[n]&&(e+=", "+n);return e}(),i=m.selectors.join(", ")+", "+t;m.selectors.forEach(function(t){const r=e.document.querySelectorAll(t);Array.prototype.forEach.call(r,function(e){n(e,o(e,!0),t,!1)})}),r.elementsReady=!0}function c(e,n,t){function a(a){let s=e.cache.get(t).get(a);return s||(e.exceptions.has(a)?s=e.exceptions.get(a).replace(/-/g,o.hyphen):-1===a.indexOf("-")?a.length>61?(r.events.dispatch("error",{lvl:"warn",msg:"found word longer than 61 characters"}),s=a):s=e.hyphenateFunction(a,i,o.leftminPerLang[n],o.rightminPerLang[n]):s=function(r){const a=String.fromCharCode(8203);let i=null,s=null,l=r;return"auto"===o.compound||"all"===o.compound?(s=c(e,n,t),i=r.split("-").map(function(e){return e.length>=o.minWordLength?s(e):e}),l="auto"===o.compound?i.join("-"):i.join("-"+a)):l=r.replace("-","-"+a),l}(a),e.cache.get(t).set(a,s)),s}const o=m[t],i=o.hyphen;return e.cache.set(t,new Map),w.set(n+"-"+t,a),a}function s(e,n,t){function a(e){let n=null;return n=l?e.normalize("NFC").replace(p,f):e.replace(p,f),1!==i.orphanControl&&(n=n.replace(/(\u0020*)(\S+)(\s*)$/,h)),n}const o=r.languages.get(e),i=m[n],s=i.minWordLength,l=m.normalize&&Boolean(String.prototype.normalize),u=e+"-"+n,f=w.has(u)?w.get(u):c(o,e,n),h=v.has(n)?v.get(n):function(e){function n(n,t,r,a){const o=m[e];let i=o.hyphen;return-1!==".\\+*?[^]$(){}=!<>|:-".indexOf(o.hyphen)&&(i="\\"+o.hyphen),3===o.orphanControl&&" "===t&&(t=String.fromCharCode(160)),t+r.replace(new RegExp(i,"g"),"")+a}return v.set(e,n),n}(n),p=o.genRegExps.get(n);let g=null;return"string"==typeof t?g=a(t):t instanceof HTMLElement&&function(n){r.events.dispatch("beforeElementHyphenation",{el:n,lang:e});const t=n.childNodes;Array.prototype.forEach.call(t,function(e){3===e.nodeType&&e.data.length>=s&&(e.data=a(e.data))}),b.counter[0]-=1,r.events.dispatch("afterElementHyphenation",{el:n,lang:e})}(t),g}function l(e,n){n?n.forEach(function(n){s(e,n.selector,n.element)}):r.events.dispatch("error",{lvl:"warn",msg:"engine for language '"+e+"' loaded, but no elements found."}),0===b.counter[0]&&r.events.dispatch("hyphenopolyEnd")}function u(e,a,o,i,c){o=o.replace(/-/g,"");const s=function(e){return r.languages||(r.languages=new Map),r.languages.has(e)||r.languages.set(e,n()),r.languages.get(e)}(e);s.engineReady||(s.cache=new Map,r.c.exceptions.global&&(r.c.exceptions[e]?r.c.exceptions[e]+=", "+r.c.exceptions.global:r.c.exceptions[e]=r.c.exceptions.global),r.c.exceptions[e]?(s.exceptions=function(e){const n=new Map;return e.split(", ").forEach(function(e){const t=e.replace(/-/g,"");n.set(t,e)}),n}(r.c.exceptions[e]),delete r.c.exceptions[e]):s.exceptions=new Map,s.genRegExps=new Map,s.leftmin=i,s.rightmin=c,s.hyphenateFunction=a,m.selectors.forEach(function(r){const a=m[r];0===a.leftminPerLang&&Object.defineProperty(a,"leftminPerLang",t(n(),2)),0===a.rightminPerLang&&Object.defineProperty(a,"rightminPerLang",t(n(),2)),a.leftminPerLang[e]?a.leftminPerLang[e]=Math.max(s.leftmin,a.leftmin,a.leftminPerLang[e]):a.leftminPerLang[e]=Math.max(s.leftmin,a.leftmin),a.rightminPerLang[e]?a.rightminPerLang[e]=Math.max(s.rightmin,a.rightmin,a.rightminPerLang[e]):a.rightminPerLang[e]=Math.max(s.rightmin,a.rightmin),s.genRegExps.set(r,new RegExp("[\\w"+o+String.fromCharCode(8204)+"-]{"+a.minWordLength+",}","gi"))}),s.engineReady=!0),Hyphenopoly.events.dispatch("engineReady",{msg:e})}function f(e){const n=new Uint32Array(e).subarray(0,8),t=n[7],a=1280+t+(4-(1280+t)%4),o=a+4*n[6];return{heapSize:Math.max(function(e){if(r.clientFeat.wasm)return 65536*Math.ceil(e/65536);const n=Math.ceil(Math.log2(e));return n<=12?4096:n<24?1<<n:Math.ceil(e/(1<<24))*(1<<24)}(o+576+n[2]+n[3]),2097152),hpbOffset:o+576,hpbPatternsOffset:o+576+n[2],hpbTranslateOffset:o+576+n[1],hyphenatedWordOffset:o+320,hyphenPointsOffset:o+256,leftmin:n[4],patternsLength:n[3],patternTrieOffset:a,rightmin:n[5],translatedWordOffset:o+128,valueStoreOffset:1280,wordOffset:o}}function h(e,n){const t=r.clientFeat.wasm?e.wasmMemory.buffer:e.heapBuffer,a=e.wordOffset,o=e.hyphenatedWordOffset,i=new Uint16Array(t).subarray(a>>1,64+(a>>1)),c=e.leftmin,s=e.rightmin,l=new Uint16Array(t).subarray(o>>1,128+(o>>1));return function(e,t,r,a){let o=0;const u=e.length;for(r=r||c,a=a||s,i[0]=u+2,i[1]=95;o<u;)i[o+2]=e.charCodeAt(o),o+=1;return i[o+2]=95,1===n(r,a)&&(e=x(l.subarray(1,l[0]+1)),"­"!==t&&(e=e.replace(/\u00AD/g,t))),e}}function p(e){Promise.all([r.binaries.get(e),r.binaries.get("hyphenEngine")]).then(function(n){const t=n[0],a=f(t),o=n[1],i=r.specMems.get(e),c=i.buffer.byteLength>=a.heapSize?i:new WebAssembly.Memory({initial:a.heapSize/65536,maximum:256});new Uint32Array(c.buffer).set(new Uint32Array(t),a.hpbOffset>>2),a.wasmMemory=c,WebAssembly.instantiate(o,{env:{memory:a.wasmMemory,memoryBase:0},ext:a}).then(function(n){const t=n.exports.convert();u(e,h(a,n.exports.hyphenate),x(new Uint16Array(c.buffer).subarray(385,384+t)),a.leftmin,a.rightmin)})})}function g(e){const n=r.binaries.get(e),t=f(n),a=r.specMems.get(e),o=a.byteLength>=t.heapSize?a:new ArrayBuffer(t.heapSize),i=new Uint8Array(o),c=new Uint8Array(n);i.set(c,t.hpbOffset),t.heapBuffer=o;const s=asmHyphenEngine({Int32Array:window.Int32Array,Math:Math,Uint16Array:window.Uint16Array,Uint8Array:window.Uint8Array},t,t.heapBuffer),l=s.convert();u(e,h(t,s.hyphenate),x(new Uint16Array(o).subarray(385,384+l)),t.leftmin,t.rightmin)}function d(e,n){"*"===e?("wasm"===n?E=p:"asm"===n&&(E=g),L.forEach(function(e){E(e)})):E?E(e):L.push(e)}const m=r.c;let y=null,b=null;const w=new Map,v=new Map;r.createHyphenator=function(e){return function(n,t){return t=t||".hyphenate",s(e,t,n)}},r.unhyphenate=function(){b.each(function(e,n){n.forEach(function(e){const n=e.element.firstChild,t=m[e.selector].hyphen;n.data=n.data.replace(new RegExp(t,"g"),"")})})};const x=function(){let e=null;if(window.TextDecoder){const n=new TextDecoder("utf-16le");e=function(e){return n.decode(e)}}else e=function(e){return String.fromCharCode.apply(null,e)};return e}();let E=null;const L=[];r.events.define("contentLoaded",function(){!function(){const n=e.document.getElementsByTagName("html")[0];(y=o(n,!1))||""===m.defaultLanguage||(y=m.defaultLanguage)}(),i(),r.events.dispatch("elementsReady")},!1),r.events.define("elementsReady",function(){b.each(function(e,n){r.languages&&r.languages.has(e)&&r.languages.get(e).engineReady&&l(e,n)})},!1),r.events.define("engineLoaded",function(e){d("*",e.msg)},!1),r.events.define("hpbLoaded",function(e){d(e.msg,"*")},!1),r.events.define("engineReady",function(e){r.elementsReady&&l(e.msg,b.list.get(e.msg))},!1),r.events.define("hyphenopolyStart",null,!0),r.events.define("hyphenopolyEnd",function(){e.clearTimeout(m.timeOutHandler),"none"!==r.c.hide&&r.toggle("on")},!1),r.events.define("beforeElementHyphenation",null,!0),r.events.define("afterElementHyphenation",null,!0),r.events.tempRegister.forEach(function(e){r.events.addListener(e.name,e.handler,!1)}),delete r.events.tempRegister,r.events.dispatch("hyphenopolyStart",{msg:"Hyphenopoly started"}),e.clearTimeout(r.c.timeOutHandler),Object.defineProperty(m,"timeOutHandler",t(e.setTimeout(function(){r.events.dispatch("timeout",{delay:m.timeout})},m.timeout),2)),r.events.deferred.forEach(function(e){r.events.dispatch(e.name,e.data)}),delete r.events.deferred}()}(window);
