/**
 * @license Hyphenopoly.module.js 3.1.2 - hyphenation for node
 * ©2018  Mathias Nater, Zürich (mathiasnater at gmail dot com)
 * https://github.com/mnater/Hyphenopoly
 *
 * Released under the MIT license
 * http://mnater.github.io/Hyphenopoly/LICENSE
 */
"use strict";function empty(){return Object.create(null)}function setProp(e,n){return{configurable:(4&n)>0,enumerable:(2&n)>0,writable:(1&n)>0,value:e}}function readFile(e,n,t){if("fs"===H.c.loader){if(t)return loader.readFileSync(e);loader.readFile(e,n)}else loader.get(e,function(e){const t=[];e.on("data",function(e){t.push(e)}),e.on("end",function(){n(null,Buffer.concat(t))})});return null}function loadWasm(){if(H.c.sync){const e=readFile(`${H.c.paths.maindir}hyphenEngine.wasm`,null,!0);H.binaries.set("hyphenEngine",new Uint8Array(e).buffer),H.events.dispatch("engineLoaded")}else readFile(`${H.c.paths.maindir}hyphenEngine.wasm`,function(e,n){e?H.events.dispatch("error",{key:"hyphenEngine",msg:`${H.c.paths.maindir}hyphenEngine.wasm not found.`}):(H.binaries.set("hyphenEngine",new Uint8Array(n).buffer),H.events.dispatch("engineLoaded"))},!1)}function loadHpb(e){if(H.c.sync){const n=readFile(`${H.c.paths.patterndir}${e}.hpb`,null,!0);H.binaries.set(e,new Uint8Array(n).buffer),H.events.dispatch("hpbLoaded",{msg:e})}else readFile(`${H.c.paths.patterndir}${e}.hpb`,function(n,t){n?H.events.dispatch("error",{key:e,msg:`${H.c.paths.patterndir}${e}.hpb not found.`}):(H.binaries.set(e,new Uint8Array(t).buffer),H.events.dispatch("hpbLoaded",{msg:e}))},!1)}function calculateHeapSize(e){return 65536*Math.ceil(e/65536)}function calculateBaseData(e){const n=new Uint32Array(e).subarray(0,8),t=n[7],r=1280+t+(4-(1280+t)%4),a=r+4*n[6];return{ho:a+512,hp:a+192,hs:Math.max(calculateHeapSize(a+512+n[2]+n[3]),2097152),hw:a+256,lm:n[4],pl:n[3],po:a+512+n[2],pt:r,rm:n[5],to:a+512+n[1],tw:a+128,vs:1280,wo:a}}function convertExceptions(e){const n=new Map;return e.split(", ").forEach(function(e){const t=e.replace(/-/g,"");n.set(t,e)}),n}function createLangObj(e){return H.languages||(H.languages=new Map),H.languages.has(e)||H.languages.set(e,empty()),H.languages.get(e)}function prepareLanguagesObj(e,n,t,r,a){t=t.replace(/-/g,"");const o=createLangObj(e);o.engineReady||(o.cache=new Map,H.c.exceptions.global&&(H.c.exceptions[e]?H.c.exceptions[e]+=`, ${H.c.exceptions.global}`:H.c.exceptions[e]=H.c.exceptions.global),H.c.exceptions[e]?(o.exceptions=convertExceptions(H.c.exceptions[e]),delete H.c.exceptions[e]):o.exceptions=new Map,o.genRegExp=new RegExp(`[\\w${t}${String.fromCharCode(8204)}-]{${H.c.minWordLength},}`,"gi"),o.leftmin=r,o.rightmin=a,o.hyphenateFunction=n,o.engineReady=!0),H.events.dispatch("engineReady",{msg:e})}function encloseHyphenateFunction(e,n){const t=e.wasmMemory.buffer,r=e.wo,a=new Uint16Array(t).subarray(r>>1,64+(r>>1)),o=e.lm,i=e.rm,c=new Uint16Array(t).subarray(e.hw>>1,128+(e.hw>>1));return a[0]=95,function(e,t,r,s){let p=0,l=e.charCodeAt(p);for(r=r||o,s=s||i;l;)a[p+=1]=l,l=e.charCodeAt(p);return a[p+1]=95,a[p+2]=0,1===n(r,s)&&(e=String.fromCharCode.apply(null,c.subarray(1,c[0]+1)),"­"!==t&&(e=e.replace(/\u00AD/g,t))),e}}function instantiateWasmEngine(e){const n=calculateBaseData(H.binaries.get(e)),t=new WebAssembly.Memory({initial:n.hs/65536,maximum:256});new Uint32Array(t.buffer).set(new Uint32Array(H.binaries.get(e)),n.ho>>2),n.wasmMemory=t;const r={env:{memory:n.wasmMemory,memoryBase:0},x:n};if(H.c.sync){const a=new WebAssembly.Instance(new WebAssembly.Module(H.binaries.get("hyphenEngine")),r);a.exports.convert(),prepareLanguagesObj(e,encloseHyphenateFunction(n,a.exports.hyphenate),decode(new Uint8Array(t.buffer).subarray(768,1280)),n.lm,n.rm)}else WebAssembly.instantiate(H.binaries.get("hyphenEngine"),r).then(function(r){r.instance.exports.convert(),prepareLanguagesObj(e,encloseHyphenateFunction(n,r.instance.exports.hyphenate),decode(new Uint8Array(t.buffer).subarray(768,1280)),n.lm,n.rm)})}function prepare(e){"*"===e?(engineInstantiator=instantiateWasmEngine,hpb.forEach(function(e){engineInstantiator(e)})):engineInstantiator?engineInstantiator(e):hpb.push(e)}function createWordHyphenator(e,n){function t(t){let r=e.cache.get(t);return r||(e.exceptions.has(t)?r=e.exceptions.get(t).replace(/-/g,H.c.hyphen):-1===t.indexOf("-")?t.length>61?(H.events.dispatch("error",{msg:"found word longer than 61 characters"}),r=t):r=e.hyphenateFunction(t,H.c.hyphen,H.c.leftmin,H.c.rightmin):r=function(t){const r=String.fromCharCode(8203);let a=null,o=null;return"auto"===H.c.compound||"all"===H.c.compound?(o=createWordHyphenator(e,n),a=t.split("-").map(function(e){return e.length>=H.c.minWordLength?o(e):e}),t="auto"===H.c.compound?a.join("-"):a.join("-"+r)):t=t.replace("-","-"+r),t}(t),e.cache.set(t,r)),r}return wordHyphenatorPool.set(n,t),t}function createTextHyphenator(e){const n=H.languages.get(e),t=wordHyphenatorPool.has(e)?wordHyphenatorPool.get(e):createWordHyphenator(n,e);return function(e){H.c.normalize&&(e=e.normalize("NFC"));let r=e.replace(n.genRegExp,t);return 1!==H.c.orphanControl&&(r=r.replace(/(\u0020*)(\S+)(\s*)$/,orphanController)),r}}let loader=require("fs");const{StringDecoder:StringDecoder}=require("string_decoder"),decode=function(){const e=new StringDecoder("utf-16le");return function(n){return e.write(Buffer.from(n))}}(),H=empty();H.binaries=new Map,H.supportedLanguages=["af","as","be","bg","bn","ca","cs","cy","da","de","el-monoton","el-polyton","en-gb","en-us","eo","es","et","eu","fi","fr","fur","ga","gl","grc","gu","hi","hr","hsb","hu","hy","ia","id","is","it","ka","kmr","kn","la-x-liturgic","la","lt","lv","ml","mn-cyrl","mr","mul-ethi","nb-no","nl","nn","oc","or","pa","pl","pms","pt","rm","ro","ru","sh-cyrl","sh-latn","sk","sl","sr-cyrl","sv","ta","te","th","tk","tr","uk","zh-latn-pinyin"];let engineInstantiator=null;const hpb=[],wordHyphenatorPool=new Map,orphanController=function(){return function(e,n,t,r){let a=H.c.hyphen;return-1!==".\\+*?[^]$(){}=!<>|:-".indexOf(H.c.hyphen)&&(a=`\\${H.c.hyphen}`),3===H.c.orphanControl&&" "===n&&(n=String.fromCharCode(160)),n+t.replace(new RegExp(a,"g"),"")+r}}();!function(){function e(e,t,r){n.set(e,{cancellable:r,default:t,register:[]})}const n=new Map;e("error",function(e){console.error(e.msg)},!0),e("engineLoaded",function(){prepare("*")},!1),e("hpbLoaded",function(e){prepare(e.msg)},!1),e("engineReady",null,!1),H.events=empty(),H.events.dispatch=function(e,t){t||(t=empty()),t.defaultPrevented=!1,t.preventDefault=function(){n.get(e).cancellable&&(t.defaultPrevented=!0)},n.get(e).register.forEach(function(e){e(t)}),!t.defaultPrevented&&n.get(e).default&&n.get(e).default(t)},H.events.define=e,H.events.addListener=function(e,t){n.has(e)?n.get(e).register.push(t):H.events.dispatch("error",{msg:`unknown Event "${e}" discarded`})}}(),H.config=function(e){const n=Object.create(null,{compound:setProp("hyphen",2),exceptions:setProp(empty(),2),hyphen:setProp(String.fromCharCode(173),2),leftmin:setProp(0,2),loader:setProp("fs",2),minWordLength:setProp(6,2),normalize:setProp(!1,2),orphanControl:setProp(1,2),paths:setProp(Object.create(null,{maindir:setProp(`${__dirname}/`,2),patterndir:setProp(`${__dirname}/patterns/`,2)}),2),require:setProp([],2),rightmin:setProp(0,2),sync:setProp(!1,2)}),t=Object.create(n);Object.keys(e).forEach(function(n){Object.defineProperty(t,n,setProp(e[n],3))}),H.c=t,"https"===H.c.loader&&(loader=require("https")),"http"===H.c.loader&&(loader=require("http")),H.c.handleEvent&&Object.keys(H.c.handleEvent).forEach(function(e){H.events.addListener(e,H.c.handleEvent[e])});const r=new Map;return 0===H.c.require.length&&H.events.dispatch("error",{msg:"No language has been required. Setup config according to documenation."}),H.c.require.forEach(function(e){if(loadHpb(e),H.c.sync)H.events.addListener("engineReady",function(n){n.msg===e&&r.set(e,createTextHyphenator(e))});else{const n=new Promise(function(n,t){H.events.addListener("engineReady",function(t){t.msg===e&&n(createTextHyphenator(e))}),H.events.addListener("error",function(n){n.preventDefault(),n.key!==e&&"hyphenEngine"!==n.key||t(n.msg)})});r.set(e,n)}}),loadWasm(),1===r.size?r.get(H.c.require[0]):r},module.exports=H;